# SSTI-ni exploit qilish

Ushbu bo'limda biz ba'zi turli [server side template injection](server-side-template-injection-ssti) zaifliklarini batafsil ko'rib chiqamiz va yuqori darajadagi metodologiyamiz yordamida ulardan qanday foydalanish mumkinligini ko'rsatamiz. Ushbu jarayonni amaliyotga tatbiq etish orqali siz turli xil server side template injection zaifliklarini topishingiz va ulardan foydalanishingiz mumkin.

Server side template injection zaifligini va foydalanilayotgan template mexanizmini aniqlaganingizdan so'ng, muvaffaqiyatli exploit qilish odatda quyidagi jarayonlarni o'z ichiga oladi.

* [O'qish ≫](ssti-ni-exploit-qilish#oqing)
  * [Template sintaksisi ≫](ssti-ni-exploit-qilish#template-sintaksisini-asoslarini-organish)
  * [Xavfsizlik dokumentatsiyasi ≫](ssti-ni-exploit-qilish#xavfsizlik-oqibatlari-haqida-oqish)
  * [Internetda mavjud exploitlar ≫](ssti-ni-exploit-qilish#look-for-known-exploits)
* [Muhitni o'rganish ≫](ssti-ni-exploit-qilish#tadqiqot-otkazish)
* [Maxsus xujumni yaratish ≫](ssti-ni-exploit-qilish#maxsus-xujum-yasash)

## O'qish <a href="#oqing" id="oqing"></a>

Agar siz template mexanizmini ichki tuzilishini bilmasangiz, uning dokumentatsiyasini o'qish odatda boshlash uchun birinchi qadam bo'ladi. Bu vaqtingizni o'tkazishning qiziqarli usuli bo'lmasa-da, dokumentatsiya juda foydali ma'lumot manbayi bo'lishi mumkinligini e'tiborsiz qoldirmaslik kerak.

## Template sintaksisining asoslarini o'rganish <a href="#template-sintaksisini-asoslarini-organish" id="template-sintaksisini-asoslarini-organish"></a>

Boshlang'ich sintaksis bilan bir qatorda funksiya kalit so'zlari va o'zgaruvchilardan foydalanishni o'rganish aniq muhimdir. Hatto oddiy kod bloklarini shablonga joylashtirishni o'rganish kabi oddiy narsa ham ba'zida  exploitga olib kelishi mumkin. Misol uchun, Python-ga asoslangan  [Mako](https://www.makotemplates.org/)  template mexanizmi ishlatilayotganligini bilganingizdan so'ng, **remote code execution** quyidagi kabi oddiy bo'lishi mumkin:

```tt2
<%
                import os
                x=os.popen('id').read()
                %>
                ${x}
```

Sandboxlanmagan muhitda **remote code execution** va undan fayllarni o'qish, tahrirlash yoki o'chirish uchun foydalanish ko'plab oddiy template engine-larda xuddi shunday.

:::caution **Lab**
 [Boshlang'ich server side template injection hujumi ≫](https://portswigger.net/web-security/server-side-template-injection/exploiting/lab-server-side-template-injection-basic)
:::

:::caution **Lab**
 [Boshlang'ich server side templte injection hujumi (code-context) ≫](https://portswigger.net/web-security/server-side-template-injection/exploiting/lab-server-side-template-injection-basic-code-context)
:::

## Xavfsizlik haqida o'qing <a href="#xavfsizlik-oqibatlari-haqida-oqish" id="xavfsizlik-oqibatlari-haqida-oqish"></a>

Dokumentatsiyada template-larni yaratish va ulardan foydalanish asoslaridan tashqari "**Xavfsizlik**" bo'limi ham manjud bo'lishi mumkin. Ushbu bo'limning nomi har xil bo'ladi, lekin unda odatda template bilan qilinmasligi kerak bo'lgan barcha xavfli narsalar keltiriladi. Bu xavfsizlik uchun juda yaxshi manba bo'lishi mumkin, hatto audit paytida nimalarga e'tibor berish kerakligi va ulardan qanday foydalanish kerakligi haqida aytilgan bo'lishi ham mumkin.

Alohida "Xavfsizlik" bo'limi bo'lmasa ham, ma'lum bir built-in obyekt yoki funksiya xavfsizlikka xavf tug'dirishi mumkin bo'lsa, dokumentatsiyada deyarli har doim qandaydir ogohlantirish bo'ladi. Ogohlantirish batafsil tafsilotlarni bermasligi mumkin, lekin hech bo'lmaganda ma'lum bit vazifaga ega built-in xususiyatni tekshirish uchun element sifatida belgilashi kerak

Masalan, ERB-da dokumentatsiya barcha direktoriyalarni ro'yxatlay olishingiz va keyin fayllarni quyidagidek o'qishingiz mumkinligini ko'rsatadi:

```tt2
<%= Dir.entries('/') %>
<%= File.open('/example/arbitrary-file').read %>
```

:::caution **Lab**
 [Dokumentatsiyadan foydalanib server side template injection hujumi ≫](https://portswigger.net/web-security/server-side-template-injection/exploiting/lab-server-side-template-injection-using-documentation)&#x20;
:::

## Mavjud exploitlarni qidiring <a href="#look-for-known-exploits" id="look-for-known-exploits"></a>

SSTI zaifliklarini exploit qilishning yana bir muhim jihati - bu qo'shimcha resurslarni internet orqali  yaxshi topa oladigan bo'lish. Foydalanilayotgan template mexanizmini aniqlaganingizdan so'ng, boshqalar allaqachon aniqlagan zaifliklar uchun Internetni ko'zdan kechirib chiqishingiz kerak. Ba'zi asosiy template mexanizmlarning keng foydalanilishligi tufayli, ba'zida target saytda qo'llash uchun yaxshi dokumentatsiyaga ega exploitlarni topish mumkin.

:::caution **Lab**
 [Dokumentatsiyalashtirilgan exploit orqali no'malum tilda SST ineksiyasi ≫](https://portswigger.net/web-security/server-side-template-injection/exploiting/lab-server-side-template-injection-in-an-unknown-language-with-a-documented-exploit)
:::

## O'rganib chiqing <a href="#tadqiqot-otkazish" id="tadqiqot-otkazish"></a>

Shu nuqtada, siz dokumentatsiyadan foydalangan holda ishlaydigan ekspluatatsiyani topgan bo'lishingiz mumkin. Agar unday bo'lsa, keyingi qadam environmentni o'rganish va foydalana ilishingiz mumkin bo'lgan barcha obyektlarni topishga harakat qilishdir.

Ko'pgina template mexanizmlar, template mexanizmi tomonidan qo'llab-quvvatlanadigan barcha obyektlar, usullar va atributlarni o'z ichiga olgan namespace kabi ishlaydigan "o'zining" yoki "environment" obyektini ko'rsatadi. Agar shunday obyekt bor bo'lsa, siz undan foydalanish doirasidagi obyektlar ro'yxatini tuziishingiz mumkin. Masalan, Java-ga asoslangan template tillarida ba'zan quyidagi ineksiya orqali environmentdagi barcha o'zgaruvchilarni ro'yxatga olishingiz mumkin:

```tt2
${T(java.lang.System).getenv()}
```

Bu qiziqarli obyektlar va keyingi tadqiqot usullarining qisqacha ro'yxatini yaratish uchun asos bo'lishi mumkin. Bundan tashqari, [Burp Suite Professional](https://portswigger.net/burp/pro) foydalanuvchilari uchun Intruder o'zgaruvchilar nomlari uchun built-in wordlistni taqdim etadi.

## Dasturchi tomonidan yaratilgan obyektlar <a href="#dasturchi-tomonidan-taqdim-etilgan-obektlar" id="dasturchi-tomonidan-taqdim-etilgan-obektlar"></a>

Shuni ta'kidlash kerakki, web-saytlar template tomonidan yaratilgan built-in obyektlarni hamda web-dasturchi tomonidan yaratilgan custom va sayt uchun maxsus obyektlarni o'z ichiga oladi. Ushbu nostandart obyektlarga alohida e'tibor berishingiz kerak, chunki ular maxfiy ma'lumotlar yoki exploit qilinadigan metodlarni o'z ichiga olishi mumkin. Ushbu obyektlar, web-sayt ichida turli template larda farq qilishi mumkinligi sababli, undan foydalanish yo'lini topishdan oldin har bir alohida template tarkibida obyektning xarakatlarini o'rganishingiz kerakligini yodda tuting.

Server side template injection, remote code execution va serverni to'liq egallab olishga olib kelishi mumkin bo'lsa-da, amaliyotda har doim ham bularni qilib bo'lavermaydi. Biroq, siz remote code execution-ni bajara olmaganingiz,  boshqa turdagi exploitlar yo'q degani emas. Maxfiy maʼlumotlarga kirishda directory traversal kabi yuqori darajali exploitlar uchun  SSTI zaifliklaridan foydalanishingiz mumkin.

:::caution **Lab**
 [Dasturchi tomonidan kiritilgan obyektlar orqali ma'lumotlarni oshkor qilishda SSTI ≫](https://portswigger.net/web-security/server-side-template-injection/exploiting/lab-server-side-template-injection-with-information-disclosure-via-user-supplied-objects)
:::

## Maxsus xujum yaratish <a href="#maxsus-xujum-yasash" id="maxsus-xujum-yasash"></a>

Hozircha biz birinchi navbatda dokumentatsiyasi mavjud exploitlardan qayta foydalanish yoki template engine dagi mashxur zaifliklardan foydalanish orqali xujumni yaratishni ko‘rib chiqdik. Biroq, ba'zida siz ham o'zingiz uchun exploitlar yaratishingiz kerak bo'ladi. Misol uchun, template mexanizmi template-larni sandbox ichida ishlatishini aniqlashingiz mumkin, bu esa exploit qilishni qiyinlashtiradi yoki exploit qilish imkonsiz bo'lishi ham mumkin.

Hujum nuqtasini aniqlagandan so'ng, zaiflikdan foydalanishning biror aniq usuli bo'lmasa, har bir funktsiyani exploit qilinadigan xatti-harakatlarni ko'rib chiqish orqali odatiy tekshriuv usullariga o'tishingiz kerak. Ushbu jarayonda uslubga tayangan holda ishlash orqali ba'zida yanada xavfsizroq bo'lgan targetlarni exploit qila oldigan murakkab xujumni yaratishingiz mumkin.

## Bir biriga ulangan obyektlardan foydalanib shaxsiy exploit tuzish

Yuqorida aytib o'tilganidek, birinchi qadam boshqarish huquqingiz bo'lgan obyektlar va metodlarni aniqlashdir. Ba'zi obyektlar darhol vazifasini tugatishi mumkin. O'z bilimlaringizni va dokumentatsiyada keltirilgan ma'lumotlarni birlashtirib, yaxshiroq tekshirmoqchi bo'lgan obyektlaringizning qisqa ro'yxatini tuzishingiz kerak.

Obyektlar haqida dokumentatsiyani o'rganayotganda, ushbu obyektlar qaysi metodlarni boshqarish huquqini berishiga, qaysi obyektlarni return qilshiga alohida e'tibor bering. Dokumentatsiyani batafsil o'rganish orqali bir-biriga ulashingiz mumkin bo'lgan obyektlar va metodlarning kombinatsiyasini topishingiz mumkin. To'g'ri obyektlar va metodlarni bir-biriga ulash ba'zan xavfli funksiyalarni va dastlab olish imkoni bo'lmagan maxfiy ma'lumotlarga kirish imkonini beradi.

Masalan, Java-ga asoslangan [Velocity](https://velocity.apache.org/) template mexanizmi da siz `$class` deb nomlangan ClassTool obyektiga kirishingiz mumkin. Dokumentatsiyani  o'rganish shuni ko'rsatadiki, siz $class.inspect() usuli va $class.type xossalarini ixtiyoriy obyektlardan malumotlar olish uchun, zanjirlab foydalanishingiz mumkin. Avvallari undan target tizimdagi terminal buyruqlarini quyidagi tarzda bajarish uchun foydalanilgan:

```tt2
$class.inspect("java.lang.Runtime").type.getRuntime().exec("bad-stuff-here")
```

:::caution **Lab**
 [Sandboxlangan enviromentlar ichida server-side template injection hujumi ≫](https://portswigger.net/web-security/server-side-template-injection/exploiting/lab-server-side-template-injection-in-a-sandboxed-environment)
:::

## Dasturchi tomonidan yaratilgan obyektlar orqali shaxsiy exploit tuzish <a href="#dasturchi-tomonidan-taqdim-etilgan-obektlar-bilan-maxsus-xujum-yasash" id="dasturchi-tomonidan-taqdim-etilgan-obektlar-bilan-maxsus-xujum-yasash"></a>

Ba'zi template engine lar xavflarni iloji boricha kamaytirish uchun standart ximoyalangan, qulflangan environmentda ishlaydi. Garchi bu, remote code executionni bajarish uchun bu kabi template-lardan foydalanishni qiyinlashtirsa-da, templatega ta'sir o'tkazadigan dasturchi tomonidan yaratilgan obyektlar keyinroq himoyasi zaifroq hujum nuqtalarini taklif qilishi mumkin.

Biroq, odatda built-in template lar uchun katta dokumentatsiyalar berilgan bo'lsa-da, saytga-xos obyektlar uchun deyarli dokumetatsiyalar taqdim qilinmaydi. Shuning uchun, ulardan qanday foydalanishni ishlab chiqish uchun sizdan web-saytning bajarayotgan harakatlarini qo'lda tekshirishingiz va hujum nuqtasini aniqlashingiz va shunga mos ravishda shaxsiy exploitingizni yaratishingiz kerak bo'ladi.

:::caution **Lab**
 [Shaxsiy exploit orqali server-side template injection hujumi ≫](https://portswigger.net/web-security/server-side-template-injection/exploiting/lab-server-side-template-injection-with-a-custom-exploit)
:::
